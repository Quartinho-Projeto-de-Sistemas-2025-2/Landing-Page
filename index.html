<!doctype html>
<html lang="pt-BR">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Quartinho</title>
  <meta name="description" content="Quartinho: facilitando a busca de moradia estudantil em Palmas!" />
  <meta property="og:title" content="Quartinho" />
  <meta property="og:description"
    content="Conectando estudantes a moradias seguras e compatíveis perto das universidades de Palmas." />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="imagens/casa1.png" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="theme-color" content="#FF8533" />
  <link rel="icon" type="image/png" href="imagens/casa1.png?v=1" />
  <link rel="apple-touch-icon" href="imagens/casa1.png?v=1" />
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="preconnect" href="https://api.allorigins.win" crossorigin>
  <link rel="preconnect" href="https://github.com" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Righteous&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="./styles.css" />
</head>

<body>
  <a href="#features" class="skip-link">Ir para conteúdo</a>
  <header class="site-header">
    <div class="container header-inner">
      <h1 class="brand">Quartinho</h1>
      <nav class="nav" aria-label="Navegação principal">
        <a href="#features">Quem somos</a>
        <a href="#mvp">Funcionalidades</a>
        <a href="#roadmap">Quanto custa?</a>
      </nav>
      <details class="mobile-nav" aria-label="Navegação móvel">
        <summary>Menu</summary>
        <nav class="nav-list">
          <a href="#features">Quem somos</a>
          <a href="#mvp">Funcionalidades</a>
          <a href="#roadmap">Quanto custa?</a>
        </nav>
      </details>
    </div>
  </header>

  <section class="hero">
    <div class="container hero-inner">
      <div class="hero-content">
        <h2>Se você é estudante, a gente tem um Quartinho para você!</h2>
        <p class="lead">Aplicativo de busca de aluguel feito por estudantes para estudantes. Contamos com filtros
          inteligentes por proximidade ao campus, afinidade entre moradores, contratos simplificados, garantia de
          segurança e anúncios verificados — tudo pensado para facilitar a vida do estudante universitário.</p>

        <!-- Estatísticas locais (valor de confiança) -->
        <div class="hero-stats" aria-hidden="false" style="margin:12px 0;display:flex;gap:12px;flex-wrap:wrap;">
          <span style="background:#fff4ea;padding:6px 10px;border-radius:999px;font-weight:600">72k+ estudantes (TO)</span>
          <span style="background:#fff;padding:6px 10px;border-radius:999px">70.1% cursos presenciais (TO)</span>
          <span style="background:#fff;padding:6px 10px;border-radius:999px">43% alunos de fora — UFT</span>
        </div>

        <p class="actions">
          <a href="#mvp" class="btn primary">Explorar Quartinho</a>
          <a href="#features" class="btn outline">Como funciona</a>
        </p>

        <p style="margin-top:12px;font-size:0.95rem;color:#6b7280;">
          Filtros por valor, gênero, distância ao campus, acessibilidade e hábitos — tudo para você encontrar um local
          confortável e seguro para estudar.
        </p>
      </div>
      <div class="hero-image">
        <img src="./imagens/casa1.png" alt="Casa — vista externa" width="360" height="220"
          style="border:0;box-shadow:none;max-width:100%;height:auto;display:block;" />
      </div>
    </div>
  </section>

  <main class="container main">
    <section id="features" class="card">
      <h3>Quem somos</h3>
      <p>Somos estudantes da UFT e criamos o Quartinho para resolver um desafio real: encontrar moradia adequada, segura
        e compatível com a vida universitária. Nossa missão é democratizar e otimizar o acesso à moradia de qualidade,
        atuando como um intermediador digital confiável.</p>

      <h4>Propósito e visão</h4>
      <p>O Quartinho nasce para centralizar informações qualificadas e facilitar a busca por moradia estudantil, unindo
        tecnologia e curadoria. Nosso diferencial está em filtros realmente úteis ao estudante: proximidade do campus,
        perfil/afinidades de moradores, gênero, hábitos e faixas de preço. A visão é tornar-se a principal plataforma de
        moradia estudantil no Brasil, conectando estudantes a ambientes de convivência que promovam seu desenvolvimento
        acadêmico e pessoal.</p>

      <!-- Destaque de valor: plataforma focada -->
      <div style="margin-top:12px;padding:12px;border-left:4px solid #FFD8BF;background:#fffef9;border-radius:8px;">
        <strong>Plataforma com foco único.</strong> Sem anúncios irrelevantes — só moradia estudantil, sem distrações.
      </div>
    </section>

    <section id="mvp" class="card">
      <h3>Funcionalidades principais</h3>
      <ul class="features-list">
        <li><strong>Filtros inteligentes</strong> — distância ao campus, hábitos, gênero, acessibilidade, faixa de preço e
          serviços (internet, limpeza).</li>
        <li><strong>Anúncios centralizados</strong> — fotos, preço, localização e perfil dos moradores em um só lugar.</li>
        <li><strong>Verificação em múltiplas etapas</strong> — cadastro com e-mail institucional e upload de comprovante de matrícula.</li>
        <li><strong>Contratos padronizados & acordo de convivência</strong> — segurança jurídica e um processo claro para
          resolver pequenos conflitos.</li>
        <li><strong>Contato seguro</strong> — comunicação protegida entre anunciante e interessado.</li>
        <li><strong>Mobile-first</strong> — foco em experiência para celulares e web responsivo.</li>
      </ul>
    </section>

    <!-- Seção do Protótipo Figma -->
    <section id="prototipo" class="card">
      <h3>Veja o protótipo do app</h3>

      <div class="figma-embed">
        <iframe style="border: 0;" width="800" height="450"
          src="https://embed.figma.com/design/iVLNSYRE2kueqLmTxqiMql/Quartinho?node-id=2-31&embed-host=share"
          allowfullscreen loading="lazy"></iframe>
      </div>
    </section>

    <section id="problema" class="card">
      <h3>Desafio da moradia estudantil em Palmas</h3>
      <p>Em Palmas, o acesso à moradia estudantil é impactado por fatores locais: múltiplos campi dispersos pela cidade,
        anúncios informais e pouca padronização de informações, além do forte cenário de moradia compartilhada. Isso
        gera insegurança, contratos pouco transparentes e dificuldades de compatibilidade entre moradores.</p>
      <ul>
        <li>Dispersão geográfica dos campi — localização e deslocamento variam por curso/campus.</li>
        <li>Alta sazonalidade e informalidade — anúncios em canais não oficiais e informações incompletas.</li>
        <li>Riscos e contratos — falta de transparência, segurança e previsibilidade de regras.</li>
        <li>Compatibilidade social — convivência em repúblicas exige afinidade de hábitos e perfis.</li>
      </ul>
      <p>O Quartinho centraliza dados, usa geolocalização e filtros de afinidade para mitigar dispersão, informalidade e
        incompatibilidades, conectando estudantes a opções mais seguras e adequadas.</p>

      <div style="margin-top:12px;padding:12px;background:#fff;padding:12px;border-radius:8px;border-left:4px solid #FFD8BF;">
        <strong>Contexto local:</strong> Palmas e o Tocantins reúnem uma população universitária expressiva — mais de <strong>72
          mil</strong> estudantes no estado; <strong>70,1%</strong> das matrículas são em cursos presenciais; na UFT, <strong>43%</strong> dos alunos são de outros estados.
        Esses números mostram a demanda e a oportunidade de impacto local — e, se considerarmos escalar para a região Norte,
        o potencial cresce ainda mais.
      </div>
    </section>

    <section id="canvas" class="card">
      <h3>Modelo de Negócio </h3>
      <h4>Segmentos de usuários</h4>
      <ul>
        <li>Estudantes que buscam moradia temporária ou permanente.</li>
        <li>Estudantes que anunciam vagas em repúblicas, kitnets, quartos.</li>
        <li>Recém-chegados que precisam de segurança e confiabilidade.</li>
        <li>Quem valoriza proximidade da instituição e compatibilidade de perfil.</li>
      </ul>
      <h4>Proposta de valor</h4>
      <ul>
        <li>Plataforma segura e dedicada a moradia estudantil.</li>
        <li>Verificação de identidade acadêmica em múltiplas etapas (e-mail institucional + comprovante de matrícula).</li>
        <li>Contratos padronizados e acordo de convivência para reduzir riscos e facilitar a segurança jurídica.</li>
        <li>Filtros avançados (gênero, hábitos, preço, localização, proximidade) e serviços complementares.</li>
        <li>Recomendações personalizadas, avaliações de convivência e comunicação centralizada.</li>
      </ul>
      <h4>Canais</h4>
      <ul>
        <li>Aplicativo mobile (principal).</li>
        <li>Site para suporte e divulgação.</li>
        <li>Parcerias com centros acadêmicos e universidades (validação e divulgação).</li>
        <li>Redes sociais e campanhas direcionadas a calouros — momento de maior busca.</li>
      </ul>
      <h4>Relacionamento com clientes</h4>
      <ul>
        <li>Atendimento via chat no app e FAQ.</li>
        <li>Sistema de avaliação entre usuários (convívio e histórico de locação).</li>
        <li>Tutoriais, guias de segurança e checklists para visitas e contratos.</li>
        <li>Serviços complementares: limpeza, internet e seguros (parceiros opcionais).</li>
      </ul>
      <h4>Fontes de receita</h4>
      <ul>
        <li>Taxa sobre contratos realizados na plataforma (modelo simbólico).</li>
        <li>Planos premium para anunciantes com maior destaque e incentivos em parceria com imobiliárias.</li>
        <li>Serviços complementares (parcerias com provedores de internet, limpeza, seguros).</li>
      </ul>
      <h4>Parcerias-chave</h4>
      <ul>
        <li>Universidades para validação e divulgação (garantia de segurança).</li>
        <li>Imobiliárias com planos de incentivo para anunciantes.</li>
        <li>Provedores de serviços (limpeza, internet, seguros) como ofertas integradas.</li>
      </ul>

      <div style="margin-top:12px;padding:10px;border-radius:10px;background:#fffef9;border-left:4px solid #FF8533;">
        <strong>Observação:</strong> o projeto é tecnicamente viável e economicamente promissor — começando por Palmas/TO e com potencial de expansão para toda a região Norte (maior alcance de estudantes, mais oferta e economia de escala).
      </div>
    </section>

    <section id="roadmap" class="card">
      <h3>Quanto custa?</h3>
      <p>Temos um plano de negócio consolidado, pensado para manter a longevidade da plataforma, mas sem perder de vista
        a condição socioeconômica do nosso público alvo.</p>

      <h4>Próximos passos e oportunidades</h4>
      <ul>
        <li>Validar parcerias com universidades para integração do fluxo de verificação.</li>
        <li>Campanhas direcionadas a calouros no início de semestre (alto pico de demanda).</li>
        <li>Modelos de incentivo com imobiliárias para aumentar oferta inicial de anúncios.</li>
        <li>Testes de serviços complementares (internet/limpeza) como receita adicional.</li>
        <li>Planejar expansão gradual para outras capitais da região Norte.</li>
      </ul>
    </section>

    <!-- INÍCIO: Seção de Depoimentos (substitui a atual) -->
    <section id="depoimentos" class="card testimonials">
      <h3>Depoimentos</h3>

      <!-- CONTROLES: opcional, aparece em telas maiores -->
      <div class="testimonials-controls" aria-hidden="true">
        <button id="prevTestimonial" aria-label="Depoimento anterior">←</button>
        <button id="nextTestimonial" aria-label="Próximo depoimento">→</button>
      </div>

      <!-- Grid (desktop) / Carrossel (mobile) -->
      <div class="testimonials-wrapper" aria-live="polite">
        <!-- Cards serão injetados por JS -->
      </div>

      <!-- Link para enviar novo depoimento (p. ex. formulário Google Forms) -->
      <p class="testimonial-cta">
        Quer deixar um depoimento? <a
          href="mailto:sac@quartinho.com?subject=Depoimento%20Quartinho&body=Escreva%20seu%20depoimento%20aqui."
          rel="noopener">Envie
          por e-mail</a>.
      </p>
    </section>
    <!-- FIM: Seção de Depoimentos -->

    <section class="card" id="graficos-pesquisa">
      <h3>O que os estudantes responderam? <span class="badge" id="respostas-badge" aria-live="polite" aria-label="Total de respostas">Carregando…</span></h3>
      <p class="muted" id="graficos-meta">Fonte: <span id="csv-source">—</span> • Atualizado em: <span id="last-updated">—</span> <button id="retry-load" class="btn outline" style="margin-left:8px">Tentar novamente</button></p>

      <div class="chart-grid">
        <div class="chart-card"><canvas id="graficoG"></canvas></div>
        <div class="chart-card"><canvas id="graficoI"></canvas></div>
        <div class="chart-card"><canvas id="graficoJ"></canvas></div>
        <div class="chart-card"><canvas id="graficoK"></canvas></div>
        <div class="chart-card"><canvas id="graficoL"></canvas></div>
        <div class="chart-card"><canvas id="graficoN"></canvas></div>
        <div class="chart-card"><canvas id="graficoQ"></canvas></div>
        <div class="chart-card"><canvas id="graficoR"></canvas></div>
      </div>
    </section>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>

    <section class="card contact-card">
      <div class="contact-grid">
        <img src="imagens/high-five-1.png?v=1" alt="Duas mãos em high five" class="contact-image" decoding="async" onerror="this.onerror=null; this.src='imagens/casa1.png?v=1'"
          width="96" height="96" />
        <div class="contact-content">
          <h3>Quer conversar com a gente?</h3>
          <p>Tem dúvidas, sugestões ou quer investir? Estamos prontos para trabalhar! Escreva para <a
              href="mailto:sac@quartinho.com">sac@quartinho.com</a> e responderemos em breve.</p>
        </div>
      </div>
    </section>

    <!-- Seção da Equipe -->
    <section class="card" id="equipe" aria-labelledby="equipe-titulo">
      <h3 id="equipe-titulo">Equipe</h3>
      <p class="muted">Conheça quem está por trás do Quartinho.</p>
      <div class="team-grid" role="list">
        <!-- membros... (mantive igual ao seu original) -->
        <a class="team-member" role="listitem" href="https://github.com/Hatilancaio" target="_blank" rel="noopener noreferrer" aria-label="Perfil GitHub de Hátilan Caio Alves Fontes">
          <img src="https://github.com/Hatilancaio.png?size=96" alt="Avatar de Hátilan Caio Alves Fontes" width="96" height="96" loading="lazy" decoding="async" />
          <span class="team-name">Hátilan Caio Alves Fontes</span>
          <span class="team-handle">@Hatilancaio</span>
        </a>
        <a class="team-member" role="listitem" href="https://github.com/joaovictormelor" target="_blank" rel="noopener noreferrer" aria-label="Perfil GitHub de João Victor Melo do Nascimento">
          <img src="https://github.com/joaovictormelor.png?size=96" alt="Avatar de João Victor Melo do Nascimento" width="96" height="96" loading="lazy" decoding="async" />
          <span class="team-name">João Victor Melo do Nascimento</span>
          <span class="team-handle">@joaovictormelor</span>
        </a>
        <a class="team-member" role="listitem" href="https://github.com/tinywin" target="_blank" rel="noopener noreferrer" aria-label="Perfil GitHub de Laura Barbosa Henrique">
          <img src="https://github.com/tinywin.png?size=96" alt="Avatar de Laura Barbosa Henrique" width="96" height="96" loading="lazy" decoding="async" />
          <span class="team-name">Laura Barbosa Henrique</span>
          <span class="team-handle">@tinywin</span>
        </a>
        <a class="team-member" role="listitem" href="https://github.com/sophiaprado1" target="_blank" rel="noopener noreferrer" aria-label="Perfil GitHub de Sophia Ribeiro Prado">
          <img src="https://github.com/sophiaprado1.png?size=96" alt="Avatar de Sophia Ribeiro Prado" width="96" height="96" loading="lazy" decoding="async" />
          <span class="team-name">Sophia Ribeiro Prado</span>
          <span class="team-handle">@sophiaprado1</span>
        </a>
        <a class="team-member" role="listitem" href="https://github.com/ViiniDev" target="_blank" rel="noopener noreferrer" aria-label="Perfil GitHub de Vinícius Wanderley Arruda">
          <img src="https://github.com/ViiniDev.png?size=96" alt="Avatar de Vinícius Wanderley Arruda" width="96" height="96" loading="lazy" decoding="async" />
          <span class="team-name">Vinícius Wanderley Arruda</span>
          <span class="team-handle">@ViiniDev</span>
        </a>
        <div class="team-member coordinator" role="listitem">
          <img src="https://github.com/edmilhomem.png?size=96" alt="Avatar de Edeilson Milhomem da Silva" width="96" height="96" loading="lazy" decoding="async" />
          <span class="team-name">Edeilson Milhomem da Silva</span>
          <span class="team-handle">@edmilhomem</span>
          <span class="role-badge" aria-label="Coordenador do projeto">Coordenador do projeto</span>
          <a class="btn outline green sm" href="https://buscatextual.cnpq.br/buscatextual/visualizacv.do?id=K4775706D6" target="_blank" rel="noopener noreferrer" aria-label="Currículo Lattes de Edeilson Milhomem da Silva">Lattes</a>
        </div>
      </div>
    </section>

    <footer class="site-footer">
      <div class="container">
        <p>Quartinho — UFT | Projeto de Sistemas | 2025 • <a
            href="https://github.com/Quartinho-Projeto-de-Sistemas-2025-2">Mais sobre o projeto</a></p>
      </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>

    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
    <script>
      // CSV publicado no Google Sheets (mantido aqui para referência)
      const SHEETS_CSV = "https://docs.google.com/spreadsheets/d/1lbLyXHfZdOsg0TDgW7jjBQJlsaqpvp5iJBtbBv-eC1Q/export?format=csv&gid=1954030778";

      // Proxy CORS para permitir leitura em ambiente estático (localhost/produção)
      const CSV_URL = "https://api.allorigins.win/raw?url=" + encodeURIComponent(SHEETS_CSV);
      // Paleta de cores para gráficos
      const PIE_COLORS = [
        '#FF8533', '#1F7A8C', '#2E294E', '#8C1F7A', '#228B22', '#F9C74F', '#90BE6D', '#277DA1', '#E76F51'
      ];
      const BAR_COLOR = '#FF8533';
      const BAR_BORDER = '#EF6A00';

      const COLS = {
        graficoG: 6,   // Você trabalha atualmente?
        graficoI: 8,   // Onde você mora atualmente?
        graficoJ: 9,   // Como encontrou a moradia?
        graficoK: 10,  // Valor aluguel atual (faixas textuais)
        graficoL: 11,  // Valor aluguel ideal (faixas textuais)
        graficoN: 13,  // Benefícios esperados
        graficoQ: 16,  // O que te faria confiar mais?
        graficoR: 17   // Pagaria taxa?
      };

      // Palavras-chave para localizar colunas por nome quando o índice mudar
      const HINTS = {
        graficoG: ['trabalha'],
        graficoI: ['mora'],
        graficoJ: ['encontrou'],
        graficoK: ['aluguel', 'atual'],
        graficoL: ['aluguel', 'ideal'],
        graficoN: ['benef'],
        graficoQ: ['confiar'],
        graficoR: ['taxa']
      };

      const norm = (s) => (s || '').toString().toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '');
      function findHeaderName(headers, colIndex, hintList = []) {
        if (headers[colIndex]) return headers[colIndex];
        const hints = (hintList || []).map(norm);
        for (const h of headers) {
          const nh = norm(h);
          if (hints.length === 0) continue;
          const ok = hints.every(k => nh.includes(k));
          if (ok) return h;
        }
        return undefined;
      }

      // estilos mínimos para canvases (garante que o gráfico seja visível)
      const style = document.createElement('style');
      style.textContent = `
    .chart-card canvas { width:100% !important; min-height:260px; display:block; }
    .chart-error { color: #b91c1c; font-weight:600; text-align:center; padding:1rem; }
  `;
      document.head.appendChild(style);

      // util: agrupa e conta respostas (trata múltipla escolha)
      function countCategorical(rows, fieldName) {
        const out = {};
        for (const r of rows) {
          if (!r.hasOwnProperty(fieldName)) continue;
          const raw = (r[fieldName] || "").toString().trim();
          if (!raw) continue;
          // separa por vírgula ou ponto-e-vírgula (algumas respostas vêm separadas por vírgula)
          const parts = raw.split(/[,;]+/).map(s => s.trim()).filter(Boolean);
          for (const p of parts) out[p] = (out[p] || 0) + 1;
        }
        return out;
      }

      // ------------------------
      // Normalização/contagem para faixas de aluguel (colunas K e L)
      // ------------------------
      // normaliza e classifica respostas de aluguel para rótulos canônicos
      function normalizePriceCategory(raw) {
        if (!raw) return null;
        let s = String(raw).toLowerCase().trim();

        // remove espaços duplicados e normaliza hífens
        s = s.replace(/\u2013|\u2014|–/g, '-').replace(/\s+/g, ' ');

        // tratamento explícito de "até" e "acima"
        if (s.match(/^\s*(até|ate)\b/) || s.match(/^(<|menos|menor)/)) {
          return 'Até R$ 500';
        }
        if (s.match(/\b(acima|mais de|>)/)) {
          return 'Acima de R$ 1200';
        }

        // tenta capturar dois números (range)
        const twoNums = s.match(/(\d{1,4}(?:[.,]\d{1,3})?)\s*[-–]\s*(\d{1,4}(?:[.,]\d{1,3})?)/);
        if (twoNums) {
          // normalizar: remove pontos de milhar e troca vírgula por ponto
          const a = twoNums[1].replace(/\./g, '').replace(',', '.');
          const b = twoNums[2].replace(/\./g, '').replace(',', '.');
          const na = Math.round(parseFloat(a));
          const nb = Math.round(parseFloat(b));
          if (!Number.isFinite(na) || !Number.isFinite(nb)) return 'Outro';
          // mapear para as faixas padrão do formulário (usar limites conhecidos)
          // se o intervalo estiver dentro [0,500] -> 'Até R$ 500', etc; senão formatar "R$ na - nb"
          if (nb <= 500) return 'Até R$ 500';
          if (na >= 1200) return 'Acima de R$ 1200';
          if (na >= 800 || nb <= 1200 && na >= 500) return 'R$ 800 - 1200';
          if (nb <= 800) return 'R$ 500 - 800';
          // fallback para exibir o próprio intervalo
          return `R$ ${na} - ${nb}`;
        }

        // tenta capturar um único número (ex: "500", "R$ 500")
        const oneNum = s.match(/(\d{1,4}(?:[.,]\d{1,3})?)/);
        if (oneNum) {
          const n = Math.round(parseFloat(oneNum[1].replace(/\./g, '').replace(',', '.')));
          if (!Number.isFinite(n)) return 'Outro';
          if (n <= 500) return 'Até R$ 500';
          if (n <= 800) return 'R$ 500 - 800';
          if (n <= 1200) return 'R$ 800 - 1200';
          return 'Acima de R$ 1200';
        }

        // se cair aqui, retorna 'Outro'
        return 'Outro';
      }

      // função que conta respostas normalizadas por faixa
      function countPriceCategories(rows, fieldName) {
        // buckets desejados (ordem fixa para o gráfico)
        const canonical = ['Até R$ 500', 'R$ 500 - 800', 'R$ 800 - 1200', 'Acima de R$ 1200', 'Outro'];
        const counts = canonical.reduce((o, k) => (o[k] = 0, o), {});
        for (const r of rows) {
          if (!r.hasOwnProperty(fieldName)) continue;
          const raw = (r[fieldName] || '').toString().trim();
          if (!raw) continue;
          const cat = normalizePriceCategory(raw);
          if (cat && counts.hasOwnProperty(cat)) counts[cat]++; else if (cat) counts['Outro']++;
        }
        const labels = canonical;
        const data = labels.map(l => counts[l]);
        return { labels, data, total: data.reduce((s, v) => s + v, 0) };
      }

      // ------------------------
      // Fim normalização preço
      // ------------------------

      function showErrorOnCanvas(canvasId, message) {
        const parent = document.getElementById(canvasId).parentElement;
        parent.innerHTML = `<div class="chart-error">${message}</div>`;
      }

      // ------------------------
      // Depoimentos a partir da coluna W (segurança no aluguel)
      // ------------------------
      let testimonialIndex = 0;
      function renderTestimonials(rows, headers) {
        const wrapper = document.querySelector('.testimonials-wrapper');
        if (!wrapper) return;
        wrapper.innerHTML = '';
        const W_INDEX_0_BASED = 22; // Coluna W
        const headerName = findHeaderName(headers, W_INDEX_0_BASED, ['funcoes', 'seguranca', 'aluguel']);
        if (!headerName) {
          wrapper.innerHTML = '<p class="muted">Pergunta de depoimentos (coluna W) não encontrada.</p>';
          return;
        }
        const quotes = rows
          .map(r => (r[headerName] || '').toString().trim())
          .filter(q => q && q.length > 0);
        if (!quotes.length) {
          wrapper.innerHTML = '<p class="muted">Ainda não há depoimentos para esta pergunta.</p>';
          return;
        }
        const maxItems = Math.min(quotes.length, 12);
        for (let i = 0; i < maxItems; i++) {
          const card = document.createElement('div');
          card.className = 'testimonial-card' + (i === 0 ? ' is-active' : '');
          const quoteEl = document.createElement('div');
          quoteEl.className = 'testimonial-quote';
          quoteEl.textContent = quotes[i];
          const authorEl = document.createElement('div');
          authorEl.className = 'testimonial-author';
          authorEl.textContent = '— Estudante';
          card.appendChild(quoteEl);
          card.appendChild(authorEl);
          wrapper.appendChild(card);
        }
        testimonialIndex = 0;
      }

      function setupTestimonialControls() {
        const prev = document.getElementById('prevTestimonial');
        const next = document.getElementById('nextTestimonial');
        const cards = document.querySelectorAll('.testimonial-card');
        if (!cards.length) return;
        const setActive = (idx) => {
          cards.forEach(c => c.classList.remove('is-active'));
          cards[idx].classList.add('is-active');
        };
        setActive(testimonialIndex);
        if (prev) prev.onclick = () => {
          testimonialIndex = (testimonialIndex - 1 + cards.length) % cards.length;
          setActive(testimonialIndex);
        };
        if (next) next.onclick = () => {
          testimonialIndex = (testimonialIndex + 1) % cards.length;
          setActive(testimonialIndex);
        };
      }

      // Fallback robusto: tenta remoto (proxy AllOrigins + Google Sheets), cai para local (dados/respostas.csv)
      async function loadCSVText() {
        try {
          const res = await fetch(CSV_URL, { cache: 'no-cache' });
          if (!res.ok) throw new Error('HTTP ' + res.status);
          const text = await res.text();
          const date = res.headers.get('date') || new Date().toISOString();
          return { text, source: 'Google Sheets (via proxy)', updatedAt: date };
        } catch (e) {
          console.warn('Falha remoto, tentando local:', e);
          const res2 = await fetch('dados/respostas.csv', { cache: 'no-cache' });
          if (!res2.ok) throw new Error('HTTP local ' + res2.status);
          const text2 = await res2.text();
          return { text: text2, source: 'Arquivo local (dados/respostas.csv)', updatedAt: new Date().toISOString() };
        }
      }

      // Nova função: baixa CSV com fetch, processa via PapaParse e desenha charts
      async function buildChartsFetch() {
        const reducedMotion = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
        try {
          const metaEls = { source: document.getElementById('csv-source'), updated: document.getElementById('last-updated') };
          const { text, source, updatedAt } = await loadCSVText();
          if (metaEls.source) metaEls.source.textContent = source;
          if (metaEls.updated) metaEls.updated.textContent = new Date(updatedAt).toLocaleString();

          const results = Papa.parse(text, { header: true, skipEmptyLines: true });
          const rows = results.data || [];
          const headers = results.meta && results.meta.fields ? results.meta.fields : [];

          if (!rows.length) {
            for (const id in COLS) showErrorOnCanvas(id, 'Sem respostas ainda.');
            console.warn('CSV vazio ou sem linhas:', results);
            return;
          }

          const badge = document.getElementById('respostas-badge');
          if (badge) badge.textContent = `${rows.length} respostas`;

          // Renderizar depoimentos da coluna W
          renderTestimonials(rows, headers);
          setupTestimonialControls();

          for (const id in COLS) {
            const colIndex = COLS[id];
            const headerName = findHeaderName(headers, colIndex, HINTS[id]);
            if (!headerName) {
              showErrorOnCanvas(id, 'Cabeçalho não encontrado (coluna ausente).');
              console.warn(`Cabeçalho não encontrado para coluna index ${colIndex}. Headers:`, headers);
              continue;
            }

            // caso K ou L (faixas de aluguel) -> normalizar categorias e desenhar barras
            if (id === 'graficoK' || id === 'graficoL') {
              const result = countPriceCategories(rows, headerName);
              if (result.total === 0) {
                showErrorOnCanvas(id, 'Sem respostas para este campo.');
                continue;
              }
              const ctx = document.getElementById(id).getContext('2d');
              new Chart(ctx, {
                type: 'bar',
                data: {
                  labels: result.labels,
                  datasets: [{
                    label: headerName,
                    data: result.data,
                    backgroundColor: BAR_COLOR,
                    borderColor: BAR_BORDER,
                    borderWidth: 1
                  }]
                },
                options: {
                  responsive: true,
                  animation: reducedMotion ? false : undefined,
                  plugins: { legend: { display: false }, title: { display: true, text: `${headerName} (n=${result.total})` } },
                  scales: { y: { beginAtZero: true } }
                }
              });
              continue;
            }

            // padrão: categórico (conta opções)
            const counts = countCategorical(rows, headerName);
            const labels = Object.keys(counts);
            const data = labels.map(l => counts[l]);

            if (labels.length === 0) {
              showErrorOnCanvas(id, 'Sem respostas para esta pergunta.');
              continue;
            }

            const total = data.reduce((s, v) => s + v, 0);
            const ctx = document.getElementById(id).getContext('2d');
            new Chart(ctx, {
              type: 'pie',
              data: {
                labels,
                datasets: [{ data, backgroundColor: PIE_COLORS.slice(0, labels.length) }]
              },
              options: {
                responsive: true,
                animation: reducedMotion ? false : undefined,
                plugins: {
                  legend: { position: 'bottom' },
                  title: { display: true, text: `${headerName} (n=${total})` },
                  datalabels: {
                    color: '#0f172a',
                    formatter: (value) => {
                      const p = total ? Math.round((value / total) * 100) : 0;
                      return p ? p + '%' : '';
                    }
                  }
                }
              }
            });
          }
        } catch (err) {
          console.error('Erro ao baixar/parsear CSV:', err);
          for (const id in COLS) showErrorOnCanvas(id, 'Erro ao carregar resultados (verifique o compartilhamento ou tente novamente).');
        }
      }

      // Função principal: baixa CSV via PapaParse (mais robusto), processa e desenha charts
      function buildCharts() {
        Papa.parse(CSV_URL, {
          download: true,
          header: true,
          skipEmptyLines: true,
          complete: function (results) {
            try {
              if (!results || !results.data || results.data.length === 0) {
                for (const id in COLS) showErrorOnCanvas(id, 'Sem respostas ainda.');
                console.warn('CSV vazio ou sem linhas:', results);
                return;
              }

              const rows = results.data;        // array de objetos {header: value}
              const headers = results.meta.fields || [];
              // Atualiza badge com total de respostas
              const badge = document.getElementById('respostas-badge');
              if (badge) badge.textContent = `${rows.length} respostas`;

              for (const id in COLS) {
                const colIndex = COLS[id];
                const headerName = findHeaderName(headers, colIndex, HINTS[id]);
                if (!headerName) {
                  showErrorOnCanvas(id, 'Cabeçalho não encontrado (coluna ausente).');
                  console.warn(`Cabeçalho não encontrado para coluna index ${colIndex}. Headers:`, headers);
                  continue;
                }

                // caso K ou L (faixas de aluguel) -> normalizar categorias e desenhar barras
                if (id === 'graficoK' || id === 'graficoL') {
                  const result = countPriceCategories(rows, headerName);
                  if (result.total === 0) {
                    showErrorOnCanvas(id, 'Sem respostas para este campo.');
                    continue;
                  }
                  const ctx = document.getElementById(id).getContext('2d');
                  new Chart(ctx, {
                    type: 'bar',
                    data: {
                      labels: result.labels,
                      datasets: [{
                        label: headerName,
                        data: result.data,
                        backgroundColor: BAR_COLOR,
                        borderColor: BAR_BORDER,
                        borderWidth: 1
                      }]
                    },
                    options: {
                      responsive: true,
                      plugins: { legend: { display: false }, title: { display: true, text: `${headerName} (n=${result.total})` } },
                      scales: { y: { beginAtZero: true } }
                    }
                  });
                  continue;
                }

                // padrão: categórico (conta opções)
                const counts = countCategorical(rows, headerName);
                const labels = Object.keys(counts);
                const data = labels.map(l => counts[l]);

                if (labels.length === 0) {
                  showErrorOnCanvas(id, 'Sem respostas para esta pergunta.');
                  continue;
                }

                const ctx = document.getElementById(id).getContext('2d');
                new Chart(ctx, {
                  type: 'pie',
                  data: {
                    labels,
                    datasets: [{ data, backgroundColor: PIE_COLORS.slice(0, labels.length) }]
                  },
                  options: {
                    responsive: true,
                    plugins: {
                      legend: { position: 'bottom' },
                      title: { display: true, text: headerName }
                    }
                  }
                });
              }
            } catch (err) {
              console.error('Erro processando CSV:', err);
              for (const id in COLS) showErrorOnCanvas(id, 'Erro ao processar resultados.');
            }
          },
          error: function (err) {
            console.error('Erro ao baixar/parsear CSV:', err);
            for (const id in COLS) showErrorOnCanvas(id, 'Erro ao carregar resultados (verifique o compartilhamento).');
          }
        });
      }

      // aguarda DOM e bibliotecas
      document.addEventListener('DOMContentLoaded', () => {
        if (typeof Chart === 'undefined') {
          console.error('Chart.js não encontrado. Verifique se o CDN está incluído.');
          for (const id in COLS) showErrorOnCanvas(id, 'Erro: biblioteca Chart.js não carregada.');
          return;
        }
        if (typeof Chart === 'object' && Chart.register) {
          if (typeof ChartDataLabels !== 'undefined') {
            Chart.register(ChartDataLabels);
          }
        }
        if (typeof Papa === 'undefined') {
          console.error('PapaParse não encontrado. Verifique se o CDN está incluído.');
          for (const id in COLS) showErrorOnCanvas(id, 'Erro: biblioteca PapaParse não carregada.');
          return;
        }
        buildChartsFetch();
        const retry = document.getElementById('retry-load');
        if (retry) retry.addEventListener('click', () => {
          for (const id in COLS) {
            const parent = document.getElementById(id).parentElement;
            parent.innerHTML = `<canvas id="${id}"></canvas>`;
          }
          buildChartsFetch();
        });
      });
    </script>



</body>

</html>